# Пошаговая инструкция: Настройка правил безопасности Firebase

## Шаг 1: Откройте Firebase Console

1. Перейдите на сайт: https://console.firebase.google.com/
2. Войдите в свой аккаунт Google
3. Выберите ваш проект (или создайте новый, если его нет)

## Шаг 2: Откройте раздел Realtime Database

1. В левом меню найдите раздел **"Realtime Database"** (или **"База данных реального времени"**)
2. Нажмите на него

## Шаг 3: Создайте базу данных (если её еще нет)

Если база данных еще не создана:
1. Нажмите кнопку **"Создать базу данных"** (или **"Create Database"**)
2. Выберите режим: **"Запустить в режиме тестирования"** (для начала) или **"Начать в производственном режиме"**
3. Выберите регион (ближайший к вам)
4. Нажмите **"Готово"**

## Шаг 4: Откройте вкладку "Rules"

1. В верхней части страницы Realtime Database вы увидите несколько вкладок:
   - **Data** (Данные)
   - **Rules** (Правила)
   - **Usage** (Использование)
   - и другие
2. Нажмите на вкладку **"Rules"** (или **"Правила"**)

## Шаг 5: Скопируйте правила безопасности

Вы увидите текстовое поле с правилами (по умолчанию там будут правила вида `".read": false`).

**УДАЛИТЕ** все содержимое этого поля и **ВСТАВЬТЕ** следующие правила:

```json
{
  "rules": {
    "nicknames": {
      ".read": "auth != null",
      "$nickname": {
        ".write": "auth != null && (!data.exists() || data.val() == auth.uid)",
        ".validate": "newData.isString() && newData.val().length > 0 && newData.val() == auth.uid"
      }
    },
    "users": {
      "$userId": {
        ".read": "auth != null",
        ".write": "auth != null && $userId == auth.uid",
        "nickname": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 15"
        }
      }
    },
    "rooms": {
      ".read": "auth != null",
      ".write": "auth != null"
    }
  }
}
```

## Шаг 6: Проверьте правила

1. После вставки правил вы увидите кнопку **"Проверить"** (или **"Validate"**) в правом нижнем углу
2. Нажмите на неё, чтобы убедиться, что правила корректны
3. Если есть ошибки, они будут подсвечены красным

## Шаг 7: Сохраните правила

1. Нажмите кнопку **"Опубликовать"** (или **"Publish"**) в правом верхнем углу
2. Подтвердите публикацию правил

## Готово! ✅

Теперь правила безопасности настроены, и система никнеймов будет работать корректно.

---

## Что делают эти правила?

### `nicknames`
- **`.read`**: Только авторизованные пользователи могут проверять, занят ли никнейм
- **`.write`**: Пользователь может зарезервировать никнейм, только если он свободен или если это его собственный никнейм
- **`.validate`**: Значение должно быть строкой (ID пользователя), не пустой, и соответствовать ID текущего пользователя

### `users`
- **`.read`**: Авторизованные пользователи могут читать профили других пользователей
- **`.write`**: Пользователь может изменять только свой собственный профиль
- **`nickname`**: Никнейм должен быть строкой длиной от 1 до 15 символов

### `rooms`
- **`.read`**: Только авторизованные пользователи могут читать данные комнат
- **`.write`**: Только авторизованные пользователи могут создавать и изменять комнаты

---

## Возможные проблемы

### Ошибка: "Rules must be a valid JSON object"
- Убедитесь, что вы скопировали правила полностью
- Проверьте, что все кавычки правильные (двойные `"`, не одинарные `'`)
- Убедитесь, что нет лишних запятых в конце объектов

### Ошибка: "Invalid rules"
- Проверьте синтаксис JSON
- Убедитесь, что все скобки закрыты

### Правила не применяются
- Убедитесь, что вы нажали **"Опубликовать"** (Publish)
- Подождите несколько секунд - правила могут применяться с задержкой

---

## Альтернативный способ: через файл

Если у вас установлен Firebase CLI, вы можете использовать файл правил:

1. Установите Firebase CLI: `npm install -g firebase-tools`
2. Войдите: `firebase login`
3. Инициализируйте проект: `firebase init`
4. Скопируйте файл `firebase-security-rules.example.json` в папку проекта
5. Загрузите правила: `firebase deploy --only database:rules`

Но для большинства пользователей проще использовать веб-интерфейс Firebase Console.



