# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º –∏–∑ –∫–æ–º–Ω–∞—Ç—ã

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ù–∞—Ö–æ–¥—è—Å—å –≤ –∫–æ–º–Ω–∞—Ç–µ —Å –¥—Ä—É–≥–æ–º, –≤–Ω–µ–∑–∞–ø–Ω–æ –≤—ã–ª–µ—Ç–∞–µ—Ç –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
- –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–æ—Ñ—Ñ–ª–∞–π–Ω"
- –ù–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –≤—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ —Å–ª—ã—à–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞
- –ó–∞—Ç–µ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

## üîç –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ **—Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É Firebase –∏ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏**:

1. **Firebase —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è** (–∏–∑-–∑–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º, —Ç–∞–π–º–∞—É—Ç–∞, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
2. **`onDisconnect()` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firebase
3. **WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –µ—â–µ –∂–∏–≤–æ** ‚Üí P2P –∞—É–¥–∏–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
4. **–ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è WebRTC —Ç–æ–∂–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è** ‚Üí –ø–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

### –ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ?

```javascript
// –°—Ç–∞—Ä—ã–π –∫–æ–¥ - –ø—Ä–æ–±–ª–µ–º–∞ –∑–¥–µ—Å—å:
myUserRef.onDisconnect().remove();
```

Firebase `onDisconnect()` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –ø—Ä–∏ –ª—é–±–æ–º —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –¥–∞–∂–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–º. –ù–æ –Ω–µ –±—ã–ª–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**.

WebRTC —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ P2P (peer-to-peer), –ø–æ—ç—Ç–æ–º—É –∞—É–¥–∏–æ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ Firebase —É–¥–∞–ª–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–º–Ω–∞—Ç—ã.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–Ω—ã–π ConnectionManager

–î–æ–±–∞–≤–ª–µ–Ω—ã:
- **Heartbeat —Å–∏—Å—Ç–µ–º–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ callback –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π** - —Ç–∞–π–º–∞—É—Ç 15 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º disconnected

```javascript
// –ù–æ–≤—ã–π –∫–æ–¥ –≤ connection.js
startHeartbeat() {
  this.heartbeatInterval = setInterval(() => {
    const now = Date.now();
    const timeSinceLastHeartbeat = now - this.lastHeartbeat;
    
    // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 15 —Å–µ–∫—É–Ω–¥ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    if (timeSinceLastHeartbeat > 15000 && this.wasConnected) {
      console.warn('‚ö†Ô∏è Heartbeat timeout: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç');
      this.wasConnected = false;
      this.onStatusChange('disconnected');
    }
  }, 5000);
}
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `attemptReconnect()`:

```javascript
async function attemptReconnect() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∏
  if (!currentRoomId || intentionalLeave || isReconnecting) return;
  
  // –õ–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ (3 –ø–æ–ø—ã—Ç–∫–∏)
  if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {
    ui.showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
    return;
  }
  
  // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–æ–º–Ω–∞—Ç–∞
  // 2. –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
  // 3. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–º–Ω–∞—Ç–µ
  // 4. –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏
}
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ConnectionManager

```javascript
connectionManager = new ConnectionManager(
  db,
  (status) => {
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    ui.updateConnectionStatus(status);
    
    if (status === 'disconnected') {
      ui.showToast("–ü–æ—Ç–µ—Ä—è–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ. –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...");
    }
  },
  // Callback –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  async () => {
    if (!intentionalLeave && joined && currentRoomId) {
      await attemptReconnect();
    }
  }
);
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (< 15 —Å–µ–∫—É–Ω–¥)

1. Firebase —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è
2. **Heartbeat –∂–¥–µ—Ç 15 —Å–µ–∫—É–Ω–¥** –ø–µ—Ä–µ–¥ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º disconnected
3. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `attemptReconnect()`**
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
6. ‚úÖ –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—Ç–∏–ª –ø—Ä–æ–±–ª–µ–º—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–ª–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (> 15 —Å–µ–∫—É–Ω–¥)

1. Firebase —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è
2. –ß–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥ –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è disconnected
3. `onDisconnect()` —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firebase
4. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `attemptReconnect()`**
6. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–º–Ω–∞—Ç–µ
7. –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Å–ª—É—à–∞—Ç–µ–ª–∏
8. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω, –∞—É–¥–∏–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

1. Firebase —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è
2. –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è #1 - –Ω–µ—É–¥–∞—á–∞
3. –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã
4. –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è #2 - –Ω–µ—É–¥–∞—á–∞
5. –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã
6. –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è #3 - –Ω–µ—É–¥–∞—á–∞
7. ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ: "–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –∫–æ–º–Ω–∞—Ç—ã

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ç–µ—Ä—è–µ—Ç —Å–≤—è–∑—å –ø—Ä–∏ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
‚úÖ **Heartbeat —Å–∏—Å—Ç–µ–º–∞** - –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π** - 15 —Å–µ–∫—É–Ω–¥ –±—É—Ñ–µ—Ä–∞ –ø–µ—Ä–µ–¥ disconnected
‚úÖ **–õ–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫** - –Ω–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ WebRTC** - –∞—É–¥–∏–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```javascript
let isReconnecting = false; // –§–ª–∞–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
let reconnectAttempts = 0; // –°—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
const MAX_RECONNECT_ATTEMPTS = 3; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ ConnectionManager

- –î–æ–±–∞–≤–ª–µ–Ω `heartbeatInterval` –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω `wasConnected` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω `lastHeartbeat` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- Callback `onReconnect` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ app.js

- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `attemptReconnect()`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ConnectionManager` —Å callback –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω —Å–±—Ä–æ—Å `reconnectAttempts` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–º –≤—ã—Ö–æ–¥–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã:

1. **–¢–µ—Å—Ç –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:**
   - –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–º–Ω–∞—Ç—É —Å –¥—Ä—É–≥–æ–º
   - –û—Ç–∫–ª—é—á–∏—Ç–µ Wi-Fi –Ω–∞ 5-10 —Å–µ–∫—É–Ω–¥
   - –í–∫–ª—é—á–∏—Ç–µ Wi-Fi
   - ‚úÖ –î–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

2. **–¢–µ—Å—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:**
   - –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–º–Ω–∞—Ç—É —Å –¥—Ä—É–≥–æ–º
   - –û—Ç–∫–ª—é—á–∏—Ç–µ Wi-Fi –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
   - –í–∫–ª—é—á–∏—Ç–µ Wi-Fi
   - ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "–ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è..." –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑—å

3. **–¢–µ—Å—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
   - –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–º–Ω–∞—Ç—É
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
   - ‚úÖ –ü–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ v1.1 (2025-01-XX)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—ã–∫–∏–¥—ã–≤–∞–ª–æ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** Callback –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Firebase (–ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ `null` –≤ `connected`), —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ `attemptReconnect()` —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤ –∫–æ–º–Ω–∞—Ç—É.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–µ–Ω `wasConnected` —Å `false` –Ω–∞ `null` –≤ –Ω–∞—á–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- Callback –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ `false` (disconnected) –≤ `true` (connected)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `attemptReconnect()`: `joined`, `myUserRef`, `myId`
- –ü–µ—Ä–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ v1.2 (2025-01-XX)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—ã–≤–∞–ª "–æ—Ç–∫–ª—é—á–µ–Ω–æ".

**–ü—Ä–∏—á–∏–Ω–∞:** Heartbeat –ø—Ä–æ–≤–µ—Ä—è–ª `this.wasConnected` (–∫–æ—Ç–æ—Ä—ã–π –±—ã–ª `null` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ) –∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ä–∞–Ω—å—à–µ, —á–µ–º Firebase —É—Å–ø–µ–≤–∞–ª –æ—Ç–≤–µ—Ç–∏—Ç—å.

**–†–µ—à–µ–Ω–∏–µ v1.2.1:**
- Heartbeat —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `this.wasConnected === true` (—Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)
- `lastHeartbeat` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `init()`
- –õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ v1.2.2 (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ):**
- Heartbeat **–æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
- Firebase `.info/connected` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- Heartbeat –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
- –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç heartbeat —Å 15 –¥–æ 30 —Å–µ–∫—É–Ω–¥
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Firebase, –±–µ–∑ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π.

## üìù –ó–∞–º–µ—Ç–∫–∏

- `onDisconnect()` –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Firebase
- Heartbeat —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–º –≤—ã—Ö–æ–¥–µ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **—É—Å—Ç–æ–π—á–∏–≤–æ –∫ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º —Å–µ—Ç–∏** –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∞—É–¥–∏–æ —Å–≤—è–∑–∏!
