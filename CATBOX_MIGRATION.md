# Миграция на Catbox.moe

## Что изменилось

Файлы теперь загружаются на Catbox.moe вместо сохранения в Firebase как base64.

### Преимущества:
- ✅ Экономия места в Firebase (только URL вместо base64)
- ✅ Экономия трафика Firebase
- ✅ Поддержка файлов до 50MB (вместо 10MB)
- ✅ Быстрая загрузка через CDN
- ✅ Файлы хранятся вечно на Catbox

### Формат данных:

**Старый формат (base64):**
```json
{
  "file": {
    "name": "image.jpg",
    "type": "image/jpeg",
    "size": 123456,
    "data": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
  }
}
```

**Новый формат (Catbox URL):**
```json
{
  "file": {
    "name": "image.jpg",
    "type": "image/jpeg",
    "size": 123456,
    "url": "https://files.catbox.moe/abc123.jpg",
    "host": "catbox"
  }
}
```

## Обратная совместимость

**ОТКЛЮЧЕНА** - старые сообщения с base64 будут показывать предупреждение:
```
⚠️ Файл в старом формате: filename.jpg
```

## Если нужна обратная совместимость

Раскомментируй в `chat.js`:

```javascript
// В createFileElement():
const fileSource = file.url || file.data; // Поддержка старых base64
```

## Очистка старых сообщений

Если хочешь удалить старые сообщения с base64 из Firebase:

1. Открой Firebase Console
2. Перейди в Realtime Database
3. Найди `rooms/{roomId}/messages`
4. Удали сообщения где `file.data` существует (без `file.url`)

## Тестирование

1. Отправь изображение - должно загрузиться на Catbox
2. Проверь консоль - увидишь URL типа `https://files.catbox.moe/...`
3. Зайди с другого аккаунта - файл должен отображаться
4. Проверь Firebase - должен быть только URL, без base64

## Лимиты Catbox.moe

- Максимальный размер файла: 200 MB
- Текущий лимит в приложении: 50 MB (можно изменить в `constants.js`)
- Хранение: вечно
- Трафик: неограничен
- Стоимость: бесплатно

## Поддерживаемые типы файлов

- Изображения: JPEG, PNG, GIF, WebP
- Аудио: MP3, WAV, OGG, M4A, WebM
- Видео: MP4, WebM, OGG

## Troubleshooting

### Файл не загружается
- Проверь размер файла (макс 50MB)
- Проверь тип файла (должен быть в списке поддерживаемых)
- Проверь интернет соединение

### Файл не отображается у других пользователей
- Открой консоль (F12) и проверь ошибки
- Убедись что URL начинается с `https://files.catbox.moe/`
- Попробуй открыть URL напрямую в браузере

### Ошибка "Файл в старом формате"
- Это старое сообщение с base64
- Можно включить обратную совместимость (см. выше)
- Или удалить старые сообщения из Firebase
